const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/Preview-Dlv_0WPE.js","assets/index-EX8v6xGV.js","assets/index-CULUp6WY.css","assets/MoveDest-5Azr5h0X.js","assets/useFileSystem-CFfN0N48.js"])))=>i.map(i=>d[i]);
import{d as Ce,a as he,r as _,b as be,w as we,c as ke,e as r,f as o,g as x,h as B,i as R,u as l,B as ze,v as Y,j as n,k as c,l as xe,m as S,n as Be,t as Ie,p as H,o as b,q as G,s as d,x as Pe,y as Ee,z as I,E as v,A as T,_ as Ve}from"./index-EX8v6xGV.js";import{u as Me,f as Ue,g as q,d as De,a as Fe,b as Se,c as Te,e as Ne,h as Ae,i as Le,j as $e,k as Ke}from"./useFileSystem-CFfN0N48.js";const Oe={class:"files_wrapper"},je={class:"bc"},Re={class:"header"},Ye={class:"flex_center"},He={style:{display:"flex","align-items":"center",gap:"8px"}},Ge=["src"],qe={class:"table-operations"},We={class:"flex_center",style:{"margin-top":"16px"}},Je={class:"dialog-footer"},Qe=Ce({__name:"Files",setup(Xe){const{path:N,parentId:A,multi:y,breadcrumbList:W,cdUp:L,loadIcons:J,getIconUrl:Q,keyword:P,pageNum:E,pageSize:V,files:X,total:Z,loadTableData:m,handleCurrentChange:ee,handleSizeChange:te,layoutStore:$,eventName:ae,handleRowClick:le}=Me();he(()=>{J(),m()});const oe=async t=>{try{const e=await q(t.id);De(e.data.data,t.name)}catch(e){console.log(e)}},ne=H(()=>G(()=>import("./Preview-Dlv_0WPE.js"),__vite__mapDeps([0,1,2]))),M=_(!1),K=_(""),O=_(""),U=_(""),se=async t=>{U.value=t.name;try{const e=await q(t.id);K.value=e.data.data,O.value=t.name.split(".").pop()?.toLowerCase()||""}catch(e){console.log(e)}finally{M.value=!0}},w=_(!1),j=_();let u=[];const ie=t=>{t.raw&&u.push(t.raw)},re=async()=>{if(!u||u.length===0){v.warning("请先选择要上传的文件");return}try{const t=[];u.forEach(p=>{t.push({originalName:p.name,contentType:p.type,size:p.size})});const s=(await Fe(t)).data.data;if(!window.APP_CONFIG.USE_MOCK){const p=[];s.forEach((i,g)=>{p.push(Se.put(i.uploadUrl,u[g],{headers:{"Content-Type":u[g]?.type},onUploadProgress:h=>{const f=Math.round(h.loaded/h.total*100);console.log("上传进度:",f)}}))}),Promise.all(p).then(async i=>{const g=[];i.forEach((h,f)=>{const D=h.headers.etag?.replace(/"/g,"");g.push({name:u[f]?.name,parentId:A.value,bucketName:window.APP_CONFIG.BUCKET,objectKey:s[f].objectName,fileSize:u[f]?.size,contentType:u[f]?.type,fileExt:u[f]?.name.split(".").pop()?.toLowerCase(),etag:D})}),await Te(g),v.success("文件上传成功"),w.value=!1,j.value?.clearFiles(),u=[],await m()}).catch(i=>{console.log("上传失败: ",i)})}}catch(t){console.error("文件上传失败:",t)}},de=()=>{T.prompt("输入文件夹名称","提示",{confirmButtonText:"确认",cancelButtonText:"取消",inputPattern:/^[^\\/:*?"<>|]+$/,inputErrorMessage:"无效名称"}).then(async({value:t})=>{await Ae({name:t.trim(),parentId:A.value}),await m(),v.success("文件夹创建成功")}).catch(()=>{v({type:"info",message:"取消创建"})})},ue=H(()=>G(()=>import("./MoveDest-5Azr5h0X.js"),__vite__mapDeps([3,1,2,4]))),C=_(!1),k=be([]),pe=async t=>{C.value=!0,k.splice(0,k.length,t)};we(()=>C.value,t=>{!t&&m()});const ce=async t=>{T.confirm(`确认删除 ${t.name} 吗？`,"提示",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"}).then(async()=>{await Ne(t.id),m(),v({type:"success",message:"删除成功"})}).catch(()=>{v({type:"info",message:"未删除"})})},me=async()=>{try{const t=await Le({itemIds:y.map(i=>i.id)}),e=t.headers["content-disposition"];let s="download.zip";if(e){const i=e.match(/filename="?(.+)"?/);i?.[1]&&(s=decodeURIComponent(i[1]))}const p=new Blob([t.data],{type:"application/zip"});$e(p,s)}catch(t){console.log("批量下载失败",t)}},fe=()=>{C.value=!0,k.splice(0,k.length,...y)},ve=()=>{T.confirm("确认删除所选文件（夹）吗？","提示",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"}).then(async()=>{await Ke({itemIds:y.map(t=>t.id)}),m(),v({type:"success",message:"删除成功"})}).catch(()=>{v({type:"info",message:"未删除"})})};return(t,e)=>{const s=c("el-button"),p=c("el-input"),i=c("el-table-column"),g=c("el-table"),h=c("el-pagination"),f=c("upload-filled"),D=c("el-icon"),ge=c("el-upload"),_e=c("el-dialog"),ye=c("el-drawer");return b(),ke("div",Oe,[r("div",je,[o(ze,{"breadcrumb-list":l(W),sepa:"/",clickable:!0,onMenuClick:l(L)},null,8,["breadcrumb-list","onMenuClick"]),R(r("div",null,[o(s,{onClick:me},{default:n(()=>[...e[9]||(e[9]=[d("批量下载",-1)])]),_:1}),o(s,{onClick:fe},{default:n(()=>[...e[10]||(e[10]=[d("批量移动",-1)])]),_:1}),o(s,{type:"danger",onClick:ve},{default:n(()=>[...e[11]||(e[11]=[d("批量删除",-1)])]),_:1})],512),[[Y,l(y).length>0]])]),r("div",Re,[r("div",Ye,[o(p,{modelValue:l(P),"onUpdate:modelValue":e[0]||(e[0]=a=>S(P)?P.value=a:null),placeholder:"输入文件名称",clearable:"",onClear:l(m),onKeyup:xe(l(m),["enter","active"])},{append:n(()=>[o(s,{icon:"Search",onClick:l(m)},null,8,["onClick"])]),_:1},8,["modelValue","onClear","onKeyup"])]),r("div",null,[R(o(s,{icon:"Back",onClick:l(L)},{default:n(()=>[...e[12]||(e[12]=[d("返回",-1)])]),_:1},8,["onClick"]),[[Y,l(N).length>1]]),o(s,{type:"primary",icon:"Plus",onClick:e[1]||(e[1]=a=>w.value=!0)},{default:n(()=>[...e[13]||(e[13]=[d("上传文件",-1)])]),_:1}),o(s,{icon:"Plus",onClick:de},{default:n(()=>[...e[14]||(e[14]=[d("新建文件夹",-1)])]),_:1})])]),o(g,Be({data:l(X)},{[Ie(l(ae))]:l(le)},{onSelectionChange:e[2]||(e[2]=a=>l(y).splice(0,l(y).length,...a))}),{default:n(()=>[o(i,{type:"selection",width:"28"}),o(i,{prop:"name",label:"文件名","show-overflow-tooltip":""},{default:n(a=>[r("div",He,[r("img",{src:l(Q)(a.row),alt:"icon",style:{width:"18px",height:"18px"}},null,8,Ge),r("span",null,Pe(a.row.name),1)])]),_:1}),l($).isMobile?B("",!0):(b(),x(i,{key:0,prop:"fileSize",label:"大小",align:"center",formatter:(a,z,F)=>l(Ue)(F)},null,8,["formatter"])),l($).isMobile?B("",!0):(b(),x(i,{key:1,prop:"createTime",label:"上传时间",align:"center",formatter:(a,z,F)=>l(Ee)(F).format("YYYY-MM-DD HH:mm:ss")},null,8,["formatter"])),o(i,{label:"操作",align:"center",width:"188"},{default:n(({row:a})=>[r("div",qe,[a.type==="FILE"?(b(),x(s,{key:0,size:"small",onClick:I(z=>oe(a),["stop"])},{default:n(()=>[...e[15]||(e[15]=[d("下载",-1)])]),_:1},8,["onClick"])):B("",!0),a.type==="FILE"?(b(),x(s,{key:1,size:"small",onClick:I(z=>se(a),["stop"])},{default:n(()=>[...e[16]||(e[16]=[d("预览",-1)])]),_:1},8,["onClick"])):B("",!0),o(s,{size:"small",onClick:I(z=>pe(a),["stop"])},{default:n(()=>[...e[17]||(e[17]=[d("移动",-1)])]),_:1},8,["onClick"]),o(s,{size:"small",type:"danger",onClick:I(z=>ce(a),["stop"])},{default:n(()=>[...e[18]||(e[18]=[d("删除",-1)])]),_:1},8,["onClick"])])]),_:1})]),_:1},16,["data"]),r("div",We,[o(h,{"current-page":l(E),"onUpdate:currentPage":e[3]||(e[3]=a=>S(E)?E.value=a:null),"page-size":l(V),"onUpdate:pageSize":e[4]||(e[4]=a=>S(V)?V.value=a:null),"page-sizes":[10,20,30,40],layout:"total, sizes, prev, pager, next",total:l(Z),onSizeChange:l(te),onCurrentChange:l(ee),size:"small"},null,8,["current-page","page-size","total","onSizeChange","onCurrentChange"])]),o(_e,{modelValue:w.value,"onUpdate:modelValue":e[6]||(e[6]=a=>w.value=a),title:"文件上传",width:"460"},{footer:n(()=>[r("div",Je,[o(s,{onClick:e[5]||(e[5]=a=>w.value=!1)},{default:n(()=>[...e[21]||(e[21]=[d("取消",-1)])]),_:1}),o(s,{type:"primary",onClick:re},{default:n(()=>[...e[22]||(e[22]=[d("确认",-1)])]),_:1})])]),default:n(()=>[o(ge,{ref_key:"upload",ref:j,drag:"",action:"",multiple:"","auto-upload":!1,onChange:ie},{tip:n(()=>[...e[19]||(e[19]=[r("div",{class:"el-upload__tip"},null,-1)])]),default:n(()=>[o(D,{class:"el-icon--upload"},{default:n(()=>[o(f)]),_:1}),e[20]||(e[20]=r("div",{class:"el-upload__text"},[d(" 将文件拖到此处，或 "),r("em",null,"点击上传")],-1))]),_:1},512)]),_:1},8,["modelValue"]),o(ye,{modelValue:M.value,"onUpdate:modelValue":e[7]||(e[7]=a=>M.value=a),title:U.value,size:"70%",direction:"btt"},{default:n(()=>[o(l(ne),{url:K.value,ext:O.value,name:U.value},null,8,["url","ext","name"])]),_:1},8,["modelValue","title"]),C.value?(b(),x(l(ue),{key:0,"cur-path":l(N),"move-visiable":C.value,"onUpdate:moveVisiable":e[8]||(e[8]=a=>C.value=a),"move-which":k},null,8,["cur-path","move-visiable","move-which"])):B("",!0)])}}}),tt=Ve(Qe,[["__scopeId","data-v-9e9071cb"]]);export{tt as default};
