const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/Preview-CMNdQOTg.js","assets/index-Cj5dF7eS.js","assets/index-CULUp6WY.css","assets/MoveDest-C-LSbfEw.js","assets/useFileSystem-HzS1LpTc.js"])))=>i.map(i=>d[i]);
import{d as be,a as we,r as f,b as he,w as ke,c as xe,e as i,f as n,g as h,h as k,i as O,u as l,B as ze,v as R,j as o,k as p,l as Ie,m as D,n as Be,t as Pe,p as j,o as y,q as Y,s as d,x as Ve,y as Fe,z as I,A as Me,E as m,C as S,_ as Ue}from"./index-Cj5dF7eS.js";import{u as Ee,f as De,g as H,d as Se,a as Te,b as Ne,s as Ae,c as $e,e as Ke,h as Le,i as Oe,j as Re}from"./useFileSystem-HzS1LpTc.js";const je={class:"files_wrapper"},Ye={class:"bc"},He={class:"header"},Ge={class:"flex_center"},qe={style:{display:"flex","align-items":"center",gap:"8px"}},We=["src"],Je={class:"table-operations"},Qe={class:"flex_center",style:{"margin-top":"16px"}},Xe={class:"dialog-footer"},Ze=be({__name:"Files",setup(et){const{path:T,parentId:N,multi:v,breadcrumbList:G,cdUp:A,loadIcons:q,getIconUrl:W,keyword:B,pageNum:P,pageSize:V,files:J,total:Q,loadTableData:c,handleCurrentChange:X,handleSizeChange:Z,layoutStore:$,eventName:ee,handleRowClick:te}=Ee();we(()=>{q(),c()});const ae=async t=>{try{const e=await H(t.id);Se(e.data.data,t.name)}catch(e){console.log(e)}},le=j(()=>Y(()=>import("./Preview-CMNdQOTg.js"),__vite__mapDeps([0,1,2]))),F=f(!1),K=f(""),L=f(""),M=f(""),ne=async t=>{M.value=t.name;try{const e=await H(t.id);K.value=e.data.data,L.value=t.name.split(".").pop()?.toLowerCase()||""}catch(e){console.log(e)}finally{F.value=!0}},C=f(!1),x=f();let r=null;const oe=t=>{r=t.raw||null},se=t=>{x.value.clearFiles();const e=t[0];e.uid=Me(),x.value.handleStart(e)},ie=async()=>{if(!r){m.warning("请先选择要上传的文件");return}try{const t=await Te({originalName:r.name,contentType:r.type,size:r.size}),{objectName:e,uploadUrl:s}=t.data.data;let _={headers:{etag:""}};!window.APP_CONFIG.USE_MOCK&&(_=await Ne.put(s,r,{headers:{"Content-Type":r.type},onUploadProgress:z=>{const U=Math.round(z.loaded/z.total*100);console.log("上传进度:",U)}}));const u=_.headers.etag?.replace(/"/g,"");await Ae({name:r.name,parentId:N.value,bucketName:window.APP_CONFIG.BUCKET,objectKey:e,fileSize:r.size,contentType:r.type,fileExt:r.name.split(".").pop()?.toLowerCase(),etag:u}),m.success("文件上传成功"),C.value=!1,x.value?.clearFiles(),r=null,await c()}catch(t){console.error("文件上传失败:",t)}},de=()=>{S.prompt("输入文件夹名称","提示",{confirmButtonText:"确认",cancelButtonText:"取消",inputPattern:/^[^\\/:*?"<>|]+$/,inputErrorMessage:"无效名称"}).then(async({value:t})=>{await Ke({name:t.trim(),parentId:N.value}),await c(),m.success("文件夹创建成功")}).catch(()=>{m({type:"info",message:"取消创建"})})},re=j(()=>Y(()=>import("./MoveDest-C-LSbfEw.js"),__vite__mapDeps([3,1,2,4]))),g=f(!1),b=he([]),ue=async t=>{g.value=!0,b.splice(0,b.length,t)};ke(()=>g.value,t=>{!t&&c()});const pe=async t=>{S.confirm(`确认删除 ${t.name} 吗？`,"提示",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"}).then(async()=>{await $e(t.id),c(),m({type:"success",message:"删除成功"})}).catch(()=>{m({type:"info",message:"未删除"})})},ce=async()=>{try{const t=await Le({itemIds:v.map(u=>u.id)}),e=t.headers["content-disposition"];let s="download.zip";if(e){const u=e.match(/filename="?(.+)"?/);u?.[1]&&(s=decodeURIComponent(u[1]))}const _=new Blob([t.data],{type:"application/zip"});Oe(_,s)}catch(t){console.log("批量下载失败",t)}},me=()=>{g.value=!0,b.splice(0,b.length,...v)},fe=()=>{S.confirm("确认删除所选文件（夹）吗？","提示",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"}).then(async()=>{await Re({itemIds:v.map(t=>t.id)}),c(),m({type:"success",message:"删除成功"})}).catch(()=>{m({type:"info",message:"未删除"})})};return(t,e)=>{const s=p("el-button"),_=p("el-input"),u=p("el-table-column"),z=p("el-table"),U=p("el-pagination"),ve=p("upload-filled"),ge=p("el-icon"),_e=p("el-upload"),ye=p("el-dialog"),Ce=p("el-drawer");return y(),xe("div",je,[i("div",Ye,[n(ze,{"breadcrumb-list":l(G),sepa:"/",clickable:!0,onMenuClick:l(A)},null,8,["breadcrumb-list","onMenuClick"]),O(i("div",null,[n(s,{onClick:ce},{default:o(()=>[...e[9]||(e[9]=[d("批量下载",-1)])]),_:1}),n(s,{onClick:me},{default:o(()=>[...e[10]||(e[10]=[d("批量移动",-1)])]),_:1}),n(s,{type:"danger",onClick:fe},{default:o(()=>[...e[11]||(e[11]=[d("批量删除",-1)])]),_:1})],512),[[R,l(v).length>0]])]),i("div",He,[i("div",Ge,[n(_,{modelValue:l(B),"onUpdate:modelValue":e[0]||(e[0]=a=>D(B)?B.value=a:null),placeholder:"输入文件名称",clearable:"",onClear:l(c),onKeyup:Ie(l(c),["enter","active"])},{append:o(()=>[n(s,{icon:"Search",onClick:l(c)},null,8,["onClick"])]),_:1},8,["modelValue","onClear","onKeyup"])]),i("div",null,[O(n(s,{icon:"Back",onClick:l(A)},{default:o(()=>[...e[12]||(e[12]=[d("返回",-1)])]),_:1},8,["onClick"]),[[R,l(T).length>1]]),n(s,{type:"primary",icon:"Plus",onClick:e[1]||(e[1]=a=>C.value=!0)},{default:o(()=>[...e[13]||(e[13]=[d("上传文件",-1)])]),_:1}),n(s,{icon:"Plus",onClick:de},{default:o(()=>[...e[14]||(e[14]=[d("新建文件夹",-1)])]),_:1})])]),n(z,Be({data:l(J)},{[Pe(l(ee))]:l(te)},{onSelectionChange:e[2]||(e[2]=a=>l(v).splice(0,l(v).length,...a))}),{default:o(()=>[n(u,{type:"selection",width:"28"}),n(u,{prop:"name",label:"文件名","show-overflow-tooltip":""},{default:o(a=>[i("div",qe,[i("img",{src:l(W)(a.row),alt:"icon",style:{width:"18px",height:"18px"}},null,8,We),i("span",null,Ve(a.row.name),1)])]),_:1}),l($).isMobile?k("",!0):(y(),h(u,{key:0,prop:"fileSize",label:"大小",align:"center",formatter:(a,w,E)=>l(De)(E)},null,8,["formatter"])),l($).isMobile?k("",!0):(y(),h(u,{key:1,prop:"createTime",label:"上传时间",align:"center",formatter:(a,w,E)=>l(Fe)(E).format("YYYY-MM-DD HH:mm:ss")},null,8,["formatter"])),n(u,{label:"操作",align:"center",width:"188"},{default:o(({row:a})=>[i("div",Je,[a.type==="FILE"?(y(),h(s,{key:0,size:"small",onClick:I(w=>ae(a),["stop"])},{default:o(()=>[...e[15]||(e[15]=[d("下载",-1)])]),_:1},8,["onClick"])):k("",!0),a.type==="FILE"?(y(),h(s,{key:1,size:"small",onClick:I(w=>ne(a),["stop"])},{default:o(()=>[...e[16]||(e[16]=[d("预览",-1)])]),_:1},8,["onClick"])):k("",!0),n(s,{size:"small",onClick:I(w=>ue(a),["stop"])},{default:o(()=>[...e[17]||(e[17]=[d("移动",-1)])]),_:1},8,["onClick"]),n(s,{size:"small",type:"danger",onClick:I(w=>pe(a),["stop"])},{default:o(()=>[...e[18]||(e[18]=[d("删除",-1)])]),_:1},8,["onClick"])])]),_:1})]),_:1},16,["data"]),i("div",Qe,[n(U,{"current-page":l(P),"onUpdate:currentPage":e[3]||(e[3]=a=>D(P)?P.value=a:null),"page-size":l(V),"onUpdate:pageSize":e[4]||(e[4]=a=>D(V)?V.value=a:null),"page-sizes":[10,20,30,40],layout:"total, sizes, prev, pager, next",total:l(Q),onSizeChange:l(Z),onCurrentChange:l(X),size:"small"},null,8,["current-page","page-size","total","onSizeChange","onCurrentChange"])]),n(ye,{modelValue:C.value,"onUpdate:modelValue":e[6]||(e[6]=a=>C.value=a),title:"文件上传",width:"460"},{footer:o(()=>[i("div",Xe,[n(s,{onClick:e[5]||(e[5]=a=>C.value=!1)},{default:o(()=>[...e[21]||(e[21]=[d("取消",-1)])]),_:1}),n(s,{type:"primary",onClick:ie},{default:o(()=>[...e[22]||(e[22]=[d("确认",-1)])]),_:1})])]),default:o(()=>[n(_e,{ref_key:"upload",ref:x,drag:"",action:"",limit:1,"on-exceed":se,"auto-upload":!1,onChange:oe},{tip:o(()=>[...e[19]||(e[19]=[i("div",{class:"el-upload__tip"}," 单次只能上传一个文件 ",-1)])]),default:o(()=>[n(ge,{class:"el-icon--upload"},{default:o(()=>[n(ve)]),_:1}),e[20]||(e[20]=i("div",{class:"el-upload__text"},[d(" 将文件拖到此处，或 "),i("em",null,"点击上传")],-1))]),_:1},512)]),_:1},8,["modelValue"]),n(Ce,{modelValue:F.value,"onUpdate:modelValue":e[7]||(e[7]=a=>F.value=a),title:M.value,size:"70%",direction:"btt"},{default:o(()=>[n(l(le),{url:K.value,ext:L.value,name:M.value},null,8,["url","ext","name"])]),_:1},8,["modelValue","title"]),g.value?(y(),h(l(re),{key:0,"cur-path":l(T),"move-visiable":g.value,"onUpdate:moveVisiable":e[8]||(e[8]=a=>g.value=a),"move-which":b},null,8,["cur-path","move-visiable","move-which"])):k("",!0)])}}}),lt=Ue(Ze,[["__scopeId","data-v-b8f00ba0"]]);export{lt as default};
