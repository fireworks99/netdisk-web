const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/Preview-77Ss1mCU.js","assets/index-CtTvRn_z.js","assets/index-CULUp6WY.css","assets/MoveDest-CtuADpb7.js","assets/useFileSystem-C7trFcMb.js"])))=>i.map(i=>d[i]);
import{d as ve,a as _e,r as c,w as fe,c as ge,b as s,e as o,f as k,g as h,u as l,B as ye,h as n,i as Ce,j as M,k as d,l as we,v as be,m as ke,t as he,n as A,o as y,p as K,q as u,s as xe,x as ze,y as x,z as Ve,E as v,A as L,_ as Fe}from"./index-CtTvRn_z.js";import{u as Ee,f as Ie,g as O,d as Pe,a as Ue,b as Me,s as Be,c as Se,e as Te}from"./useFileSystem-C7trFcMb.js";const Ne={class:"files_wrapper"},De={class:"bc"},$e={class:"header"},Ae={class:"flex_center"},Ke={style:{display:"flex","align-items":"center",gap:"8px"}},Le=["src"],Oe={class:"table-operations"},Re={class:"flex_center",style:{"margin-top":"16px"}},je={class:"dialog-footer"},Ye=ve({__name:"Files",setup(He){const{path:B,parentId:S,breadcrumbList:R,cdUp:T,loadIcons:j,getIconUrl:Y,keyword:z,pageNum:V,pageSize:F,files:H,total:G,loadTableData:p,handleCurrentChange:q,handleSizeChange:W,layoutStore:J,eventName:Q,handleRowClick:X}=Ee();_e(()=>{j(),p()});const Z=async a=>{try{const e=await O(a.id);Pe(e.data.data,a.name)}catch(e){console.log(e)}},ee=A(()=>K(()=>import("./Preview-77Ss1mCU.js"),__vite__mapDeps([0,1,2]))),E=c(!1),N=c(""),D=c(""),I=c(""),te=async a=>{I.value=a.name;try{const e=await O(a.id);N.value=e.data.data,D.value=a.name.split(".").pop()?.toLowerCase()||""}catch(e){console.log(e)}finally{E.value=!0}},_=c(!1),C=c();let i=null;const ae=a=>{i=a.raw||null},le=a=>{C.value.clearFiles();const e=a[0];e.uid=Ve(),C.value.handleStart(e)},oe=async()=>{if(!i){v.warning("请先选择要上传的文件");return}try{const a=await Ue({originalName:i.name,contentType:i.type,size:i.size}),{objectName:e,uploadUrl:r}=a.data.data;let w={headers:{etag:""}};!window.APP_CONFIG.USE_MOCK&&(w=await Me.put(r,i,{headers:{"Content-Type":i.type},onUploadProgress:b=>{const P=Math.round(b.loaded/b.total*100);console.log("上传进度:",P)}}));const m=w.headers.etag?.replace(/"/g,"");await Be({name:i.name,parentId:S.value,bucketName:window.APP_CONFIG.BUCKET,objectKey:e,fileSize:i.size,contentType:i.type,fileExt:i.name.split(".").pop()?.toLowerCase(),etag:m}),v.success("文件上传成功"),_.value=!1,C.value?.clearFiles(),i=null,await p()}catch(a){console.error("文件上传失败:",a)}},ne=()=>{L.prompt("输入文件夹名称","提示",{confirmButtonText:"确认",cancelButtonText:"取消",inputPattern:/^[^\\/:*?"<>|]+$/,inputErrorMessage:"无效名称"}).then(async({value:a})=>{await Te({name:a.trim(),parentId:S.value}),await p(),v.success("文件夹创建成功")}).catch(()=>{v({type:"info",message:"取消创建"})})},se=A(()=>K(()=>import("./MoveDest-CtuADpb7.js"),__vite__mapDeps([3,1,2,4]))),f=c(!1),$=c(),ie=async a=>{f.value=!0,$.value=a};fe(()=>f.value,a=>{!a&&p()});const re=async a=>{L.confirm(`确认删除 ${a.name} 吗？`,"提示",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"}).then(async()=>{await Se(a.id),p(),v({type:"success",message:"删除成功"})}).catch(()=>{v({type:"info",message:"未删除"})})};return(a,e)=>{const r=d("el-button"),w=d("el-input"),m=d("el-table-column"),b=d("el-table"),P=d("el-pagination"),de=d("upload-filled"),ue=d("el-icon"),pe=d("el-upload"),ce=d("el-dialog"),me=d("el-drawer");return y(),ge("div",Ne,[s("div",De,[o(ye,{"breadcrumb-list":l(R),sepa:"/",clickable:!0,onMenuClick:l(T)},null,8,["breadcrumb-list","onMenuClick"])]),s("div",$e,[s("div",Ae,[o(w,{modelValue:l(z),"onUpdate:modelValue":e[0]||(e[0]=t=>M(z)?z.value=t:null),placeholder:"输入文件名称",clearable:"",onClear:l(p),onKeyup:Ce(l(p),["enter","active"])},{append:n(()=>[o(r,{icon:"Search",onClick:l(p)},null,8,["onClick"])]),_:1},8,["modelValue","onClear","onKeyup"])]),s("div",null,[we(o(r,{icon:"Back",onClick:l(T)},{default:n(()=>[...e[8]||(e[8]=[u("返回",-1)])]),_:1},8,["onClick"]),[[be,l(B).length>1]]),o(r,{type:"primary",icon:"Plus",onClick:e[1]||(e[1]=t=>_.value=!0)},{default:n(()=>[...e[9]||(e[9]=[u("上传文件",-1)])]),_:1}),o(r,{icon:"Plus",onClick:ne},{default:n(()=>[...e[10]||(e[10]=[u("新建文件夹",-1)])]),_:1})])]),o(b,ke({data:l(H)},{[he(l(Q))]:l(X)}),{default:n(()=>[o(m,{prop:"name",label:"文件名","show-overflow-tooltip":""},{default:n(t=>[s("div",Ke,[s("img",{src:l(Y)(t.row),alt:"icon",style:{width:"18px",height:"18px"}},null,8,Le),s("span",null,xe(t.row.name),1)])]),_:1}),o(m,{prop:"fileSize",label:"大小",align:"center",formatter:(t,g,U)=>l(Ie)(U)},null,8,["formatter"]),l(J).isMobile?h("",!0):(y(),k(m,{key:0,prop:"createTime",label:"上传时间",align:"center",formatter:(t,g,U)=>l(ze)(U).format("YYYY-MM-DD HH:mm:ss")},null,8,["formatter"])),o(m,{label:"操作",align:"center",width:"188"},{default:n(({row:t})=>[s("div",Oe,[t.type==="FILE"?(y(),k(r,{key:0,size:"small",onClick:x(g=>Z(t),["stop"])},{default:n(()=>[...e[11]||(e[11]=[u("下载",-1)])]),_:1},8,["onClick"])):h("",!0),t.type==="FILE"?(y(),k(r,{key:1,size:"small",onClick:x(g=>te(t),["stop"])},{default:n(()=>[...e[12]||(e[12]=[u("预览",-1)])]),_:1},8,["onClick"])):h("",!0),o(r,{size:"small",onClick:x(g=>ie(t),["stop"])},{default:n(()=>[...e[13]||(e[13]=[u("移动",-1)])]),_:1},8,["onClick"]),o(r,{size:"small",type:"danger",onClick:x(g=>re(t),["stop"])},{default:n(()=>[...e[14]||(e[14]=[u("删除",-1)])]),_:1},8,["onClick"])])]),_:1})]),_:1},16,["data"]),s("div",Re,[o(P,{"current-page":l(V),"onUpdate:currentPage":e[2]||(e[2]=t=>M(V)?V.value=t:null),"page-size":l(F),"onUpdate:pageSize":e[3]||(e[3]=t=>M(F)?F.value=t:null),"page-sizes":[10,20,30,40],layout:"total, sizes, prev, pager, next",total:l(G),onSizeChange:l(W),onCurrentChange:l(q),size:"small"},null,8,["current-page","page-size","total","onSizeChange","onCurrentChange"])]),o(ce,{modelValue:_.value,"onUpdate:modelValue":e[5]||(e[5]=t=>_.value=t),title:"文件上传",width:"460"},{footer:n(()=>[s("div",je,[o(r,{onClick:e[4]||(e[4]=t=>_.value=!1)},{default:n(()=>[...e[17]||(e[17]=[u("取消",-1)])]),_:1}),o(r,{type:"primary",onClick:oe},{default:n(()=>[...e[18]||(e[18]=[u("确认",-1)])]),_:1})])]),default:n(()=>[o(pe,{ref_key:"upload",ref:C,drag:"",action:"",limit:1,"on-exceed":le,"auto-upload":!1,onChange:ae},{tip:n(()=>[...e[15]||(e[15]=[s("div",{class:"el-upload__tip"}," 单次只能上传一个文件 ",-1)])]),default:n(()=>[o(ue,{class:"el-icon--upload"},{default:n(()=>[o(de)]),_:1}),e[16]||(e[16]=s("div",{class:"el-upload__text"},[u(" 将文件拖到此处，或 "),s("em",null,"点击上传")],-1))]),_:1},512)]),_:1},8,["modelValue"]),o(me,{modelValue:E.value,"onUpdate:modelValue":e[6]||(e[6]=t=>E.value=t),title:I.value,size:"70%",direction:"btt"},{default:n(()=>[o(l(ee),{url:N.value,ext:D.value,name:I.value},null,8,["url","ext","name"])]),_:1},8,["modelValue","title"]),f.value?(y(),k(l(se),{key:0,"cur-path":l(B),"move-visiable":f.value,"onUpdate:moveVisiable":e[7]||(e[7]=t=>f.value=t),"move-which":$.value},null,8,["cur-path","move-visiable","move-which"])):h("",!0)])}}}),We=Fe(Ye,[["__scopeId","data-v-faf68d27"]]);export{We as default};
