const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/Preview-D_yHppn2.js","assets/index-CsUDUn4G.js","assets/index-CULUp6WY.css"])))=>i.map(i=>d[i]);
import{r as ve,a as K,f as fe,b,u as ge,d as y,e as Q,g as X,w as Y,h as $,i as o,j as v,o as O,k as c,l as a,m as Z,n as s,B as ee,v as te,t as ae,p as le,q as oe,s as _,E as x,c as ye,x as H,y as be,z as N,A as he,C as xe,D as G,_ as we}from"./index-CsUDUn4G.js";import{g as ke,_ as Ce,m as Ee,f as Ie,a as J,d as Ve,b as De,c as Pe,s as Te,e as Le,h as Fe}from"./dynamic-import-helper-Cm1A7m1i.js";const se=z=>{const r=ve([{id:-1,type:"FOLDER",name:"",parentId:null,ownerId:-1,bucketName:null,objectKey:null,fileSize:null,contentType:null,fileExt:null,etag:null,isDeleted:!1,deletedAt:null,createTime:"",updateTime:""}]),p=K(()=>r.length>1?r[r.length-1]?.id:void 0),F=K(()=>r.map(t=>({path:t.name+"_"+t.id,icon:fe,title:t.name}))),m=t=>{if(t?.path){if(t.path==="__ellipsis__")return;for(;r.length>1;){const n=r[r.length-1];if(n?.name+"_"+n?.id!==t.path)r.pop();else break}}else r.length>1&&r.pop();C()},w=b({}),D=["folder","file","pdf","docx","xlsx","pptx","image","audio","video","md"],M=async()=>{for(const t of D){const n=await Ce(Object.assign({"../assets/images/icons/audio.svg":()=>y(()=>import("./audio-BgyP0fEQ.js"),[]),"../assets/images/icons/docx.svg":()=>y(()=>import("./docx-Dc9exPZ4.js"),[]),"../assets/images/icons/file.svg":()=>y(()=>import("./file-8efNKRjW.js"),[]),"../assets/images/icons/folder.svg":()=>y(()=>import("./folder-DSJNdW5D.js"),[]),"../assets/images/icons/image.svg":()=>y(()=>import("./image-DLn9MuYV.js"),[]),"../assets/images/icons/md.svg":()=>y(()=>import("./md-Wca2XR1R.js"),[]),"../assets/images/icons/pdf.svg":()=>y(()=>import("./pdf-Cl5NwO0Y.js"),[]),"../assets/images/icons/pptx.svg":()=>y(()=>import("./pptx-BXalMJSa.js"),[]),"../assets/images/icons/video.svg":()=>y(()=>import("./video-kaPZXCcl.js"),[]),"../assets/images/icons/xlsx.svg":()=>y(()=>import("./xlsx-DkLPkXK6.js"),[])}),`../assets/images/icons/${t}.svg`,5);w.value[t]=n.default}},h=t=>{const n=P(t);return w.value[n]||w.value.file},P=t=>{if(t.type==="FOLDER")return"folder";const n=k(t.name);return{pdf:"pdf",doc:"docx",docx:"docx",xls:"xlsx",xlsx:"xlsx",ppt:"pptx",pptx:"pptx",jpg:"image",jpeg:"image",png:"image",svg:"image",md:"md",mp3:"audio",mp4:"video",webm:"video",mov:"video",ogv:"video"}[n.toLowerCase()]||"file"},k=t=>{const n=t.split(".");return n.length>1?n.pop():""},T=b([]),C=async()=>{const t=await ke(p.value?{parentId:p.value}:void 0);T.value=t.data.data},f=ge(),E=K(()=>f.isMobile?"row-click":"row-dblclick");return{path:r,parentId:p,breadcrumbList:F,cdUp:m,iconMap:w,loadIcons:M,getIconUrl:h,getFileIconName:P,getFileExtension:k,files:T,loadTableData:C,layoutStore:f,eventName:E,handleRowClick:t=>{t.type==="FOLDER"&&(r.push(t),C())}}},Me={class:"move_wrapper"},Re={class:"flex_bet"},Oe={style:{display:"flex","align-items":"center",gap:"8px"}},Ae=["src"],Ue={class:"dialog-footer"},Be=Q({__name:"MoveDest",props:{curPath:{type:Array,required:!0,default:()=>[]},moveVisiable:{type:Boolean,default:!1},moveWhich:{type:Object,default:null}},emits:["update:moveVisiable"],setup(z,{emit:r}){const p=z,F=r,{path:m,breadcrumbList:w,cdUp:D,loadIcons:M,getIconUrl:h,files:P,loadTableData:k,eventName:T,handleRowClick:C}=se();X(()=>{M(),k()});const f=b(p.moveVisiable);Y(()=>p.moveVisiable,u=>{u&&(m.splice(0,m.length,...p.curPath),k()),f.value=u},{immediate:!0}),Y(f,u=>{F("update:moveVisiable",u)});const E=async()=>{if(m.some(u=>u.id===p.moveWhich.id)){x.warning("不能选择当前文件夹及其子孙文件夹");return}if(m[m.length-1]?.id===p.moveWhich.parentId||m.length===1&&p.moveWhich.parentId===null){x.warning("当前文件（夹）就在这个位置，无需移动");return}try{const u=m[m.length-1]?.id;await Ee({id:p.moveWhich.id,parentId:u===-1?null:u}),f.value=!1}catch{x.error("移动失败")}};return(u,t)=>{const n=v("el-button"),A=v("el-table-column"),I=v("el-table"),L=v("el-dialog");return O(),$(L,{modelValue:f.value,"onUpdate:modelValue":t[1]||(t[1]=d=>f.value=d),title:"文件上传",width:"460"},{footer:o(()=>[c("div",Ue,[a(n,{onClick:t[0]||(t[0]=d=>f.value=!1)},{default:o(()=>[...t[2]||(t[2]=[_("取消",-1)])]),_:1}),a(n,{type:"primary",onClick:E},{default:o(()=>[...t[3]||(t[3]=[_("确认",-1)])]),_:1})])]),default:o(()=>[c("div",Me,[c("div",Re,[a(ee,{"breadcrumb-list":s(w),sepa:"/",clickable:!0,onMenuClick:s(D)},null,8,["breadcrumb-list","onMenuClick"]),Z(a(n,{icon:"Back",onClick:s(D),size:"small"},null,8,["onClick"]),[[te,s(m).length>1]])]),a(I,le({data:s(P)},{[oe(s(T))]:s(C)}),{default:o(()=>[a(A,{prop:"name",label:"文件名","show-overflow-tooltip":""},{default:o(d=>[c("div",Oe,[c("img",{src:s(h)(d.row),alt:"icon",style:{width:"18px",height:"18px"}},null,8,Ae),c("span",null,ae(d.row.name),1)])]),_:1})]),_:1},16,["data"])])]),_:1},8,["modelValue"])}}}),Ne={class:"files_wrapper"},$e={class:"header"},ze={style:{display:"flex"}},Se={style:{display:"flex","align-items":"center",gap:"8px"}},je=["src"],We={class:"table-operations"},Ke={class:"dialog-footer"},He=Q({__name:"Files",setup(z){const{path:r,parentId:p,breadcrumbList:F,cdUp:m,loadIcons:w,getIconUrl:D,files:M,loadTableData:h,layoutStore:P,eventName:k,handleRowClick:T}=se();X(()=>{w(),h()});const C=async l=>{try{const e=await J(l.id);Ve(e.data.data,l.name)}catch(e){console.log(e)}},f=he(()=>y(()=>import("./Preview-D_yHppn2.js"),__vite__mapDeps([0,1,2]))),E=b(!1),u=b(""),t=b(""),n=b(""),A=async l=>{n.value=l.name;try{const e=await J(l.id);u.value=e.data.data,t.value=l.name.split(".").pop()?.toLowerCase()||""}catch(e){console.log(e)}finally{E.value=!0}},I=b(!1),L=b();let d=null;const ne=l=>{d=l.raw||null},ie=l=>{L.value.clearFiles();const e=l[0];e.uid=xe(),L.value.handleStart(e)},de=async()=>{if(!d){x.warning("请先选择要上传的文件");return}try{const l=await De({originalName:d.name,contentType:d.type,size:d.size}),{objectName:e,uploadUrl:g}=l.data.data;let V={headers:{etag:""}};!window.APP_CONFIG.USE_MOCK&&(V=await Pe.put(g,d,{headers:{"Content-Type":d.type},onUploadProgress:B=>{const j=Math.round(B.loaded/B.total*100);console.log("上传进度:",j)}}));const S=V.headers.etag?.replace(/"/g,"");await Te({name:d.name,parentId:p.value,bucketName:window.APP_CONFIG.BUCKET,objectKey:e,fileSize:d.size,contentType:d.type,fileExt:d.name.split(".").pop()?.toLowerCase(),etag:S}),x.success("文件上传成功"),I.value=!1,L.value?.clearFiles(),d=null,await h()}catch(l){console.error("文件上传失败:",l)}},re=()=>{G.prompt("输入文件夹名称","提示",{confirmButtonText:"确认",cancelButtonText:"取消",inputPattern:/^[^\\/:*?"<>|]+$/,inputErrorMessage:"无效名称"}).then(async({value:l})=>{await Fe({name:l.trim(),parentId:p.value}),await h(),x.success("文件夹创建成功")}).catch(()=>{x({type:"info",message:"取消创建"})})},U=b(!1),q=b(),ce=async l=>{U.value=!0,q.value=l};Y(()=>U.value,l=>{!l&&h()});const ue=async l=>{G.confirm(`确认删除 ${l.name} 吗？`,"提示",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"}).then(async()=>{await Le(l.id),h(),x({type:"success",message:"删除成功"})}).catch(()=>{x({type:"info",message:"未删除"})})};return(l,e)=>{const g=v("el-button"),V=v("el-table-column"),S=v("el-table"),B=v("upload-filled"),j=v("el-icon"),pe=v("el-upload"),me=v("el-dialog"),_e=v("el-drawer");return O(),ye("div",Ne,[c("div",$e,[c("div",null,[a(ee,{"breadcrumb-list":s(F),sepa:"/",clickable:!0,onMenuClick:s(m)},null,8,["breadcrumb-list","onMenuClick"])]),c("div",ze,[Z(a(g,{icon:"Back",onClick:s(m)},{default:o(()=>[...e[5]||(e[5]=[_("返回上级",-1)])]),_:1},8,["onClick"]),[[te,s(r).length>1]]),a(g,{type:"primary",icon:"Plus",onClick:e[0]||(e[0]=i=>I.value=!0)},{default:o(()=>[...e[6]||(e[6]=[_("上传文件",-1)])]),_:1}),a(g,{icon:"Plus",onClick:re},{default:o(()=>[...e[7]||(e[7]=[_("新建文件夹",-1)])]),_:1})])]),a(S,le({data:s(M)},{[oe(s(k))]:s(T)}),{default:o(()=>[a(V,{prop:"name",label:"文件名","show-overflow-tooltip":""},{default:o(i=>[c("div",Se,[c("img",{src:s(D)(i.row),alt:"icon",style:{width:"18px",height:"18px"}},null,8,je),c("span",null,ae(i.row.name),1)])]),_:1}),a(V,{prop:"fileSize",label:"大小",align:"center",formatter:(i,R,W)=>s(Ie)(W)},null,8,["formatter"]),s(P).isMobile?H("",!0):(O(),$(V,{key:0,prop:"createTime",label:"上传时间",align:"center",formatter:(i,R,W)=>s(be)(W).format("YYYY-MM-DD HH:mm:ss")},null,8,["formatter"])),a(V,{label:"操作",align:"center",width:"188"},{default:o(({row:i})=>[c("div",We,[i.type==="FILE"?(O(),$(g,{key:0,size:"small",onClick:N(R=>C(i),["stop"])},{default:o(()=>[...e[8]||(e[8]=[_("下载",-1)])]),_:1},8,["onClick"])):H("",!0),i.type==="FILE"?(O(),$(g,{key:1,size:"small",onClick:N(R=>A(i),["stop"])},{default:o(()=>[...e[9]||(e[9]=[_("预览",-1)])]),_:1},8,["onClick"])):H("",!0),a(g,{size:"small",onClick:N(R=>ce(i),["stop"])},{default:o(()=>[...e[10]||(e[10]=[_("移动",-1)])]),_:1},8,["onClick"]),a(g,{size:"small",type:"danger",onClick:N(R=>ue(i),["stop"])},{default:o(()=>[...e[11]||(e[11]=[_("删除",-1)])]),_:1},8,["onClick"])])]),_:1})]),_:1},16,["data"]),a(me,{modelValue:I.value,"onUpdate:modelValue":e[2]||(e[2]=i=>I.value=i),title:"文件上传",width:"460"},{footer:o(()=>[c("div",Ke,[a(g,{onClick:e[1]||(e[1]=i=>I.value=!1)},{default:o(()=>[...e[14]||(e[14]=[_("取消",-1)])]),_:1}),a(g,{type:"primary",onClick:de},{default:o(()=>[...e[15]||(e[15]=[_("确认",-1)])]),_:1})])]),default:o(()=>[a(pe,{ref_key:"upload",ref:L,drag:"",action:"",limit:1,"on-exceed":ie,"auto-upload":!1,onChange:ne},{tip:o(()=>[...e[12]||(e[12]=[c("div",{class:"el-upload__tip"}," 单次只能上传一个文件 ",-1)])]),default:o(()=>[a(j,{class:"el-icon--upload"},{default:o(()=>[a(B)]),_:1}),e[13]||(e[13]=c("div",{class:"el-upload__text"},[_(" 将文件拖到此处，或 "),c("em",null,"点击上传")],-1))]),_:1},512)]),_:1},8,["modelValue"]),a(_e,{modelValue:E.value,"onUpdate:modelValue":e[3]||(e[3]=i=>E.value=i),title:n.value,size:"70%",direction:"btt"},{default:o(()=>[a(s(f),{url:u.value,ext:t.value,name:n.value},null,8,["url","ext","name"])]),_:1},8,["modelValue","title"]),a(Be,{"cur-path":s(r),"move-visiable":U.value,"onUpdate:moveVisiable":e[4]||(e[4]=i=>U.value=i),"move-which":q.value},null,8,["cur-path","move-visiable","move-which"])])}}}),Ge=we(He,[["__scopeId","data-v-c191b532"]]);export{Ge as default};
