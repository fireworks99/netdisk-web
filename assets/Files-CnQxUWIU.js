const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/Preview-HbnZIXP6.js","assets/index-DFYbR7MT.js","assets/index-DJt8hWD7.css","assets/MoveDest-BuIihK3P.js","assets/useFileSystem-BHA1_ldw.js"])))=>i.map(i=>d[i]);
import{d as Pe,a as Fe,r as p,w as $,b as Ee,c as Me,e as d,f as l,g as V,h as B,i as te,u as n,B as De,v as le,j as o,k as u,l as Se,m as K,n as Te,t as Ne,p as ae,o as x,q as oe,s as r,x as Le,y as Ae,z,E as v,A as O,_ as $e}from"./index-DFYbR7MT.js";import{u as Ke,f as Oe,g as ne,d as je,a as Re,b as Ye,c as He,e as Ge,h as qe,i as We,j as Je,k as Qe}from"./useFileSystem-BHA1_ldw.js";import{s as Xe}from"./favorite-CdI5XP4s.js";const Ze={class:"files_wrapper"},et={class:"bc"},tt={class:"header"},lt={class:"flex_center"},at={style:{display:"flex","align-items":"center",gap:"8px"}},ot=["src"],nt={class:"table-operations"},st={class:"flex_center",style:{"margin-top":"16px"}},it={class:"dialog-footer"},dt=Pe({__name:"Files",setup(rt){const{path:j,parentId:R,multi:g,breadcrumbList:se,cdUp:Y,loadIcons:ie,getIconUrl:de,keyword:U,pageNum:I,pageSize:P,files:re,total:ue,loadTableData:c,handleCurrentChange:pe,handleSizeChange:ce,layoutStore:H,eventName:me,handleRowClick:fe}=Ke();Fe(()=>{ie(),c()});const ve=async t=>{try{const e=await ne(t.id);je(e.data.data,t.name)}catch(e){console.log(e)}},_e=ae(()=>oe(()=>import("./Preview-HbnZIXP6.js"),__vite__mapDeps([0,1,2]))),F=p(!1),G=p(""),q=p(""),E=p(""),ge=async t=>{E.value=t.name;try{const e=await ne(t.id);G.value=e.data.data,q.value=t.name.split(".").pop()?.toLowerCase()||""}catch(e){console.log(e)}finally{F.value=!0}},k=p(!1),M=p("first"),W=p(),D=p([]),S=[];$(()=>D.value,t=>{S.splice(0,S.length,...t.map(e=>e.raw))});const J=p(),T=p([]),N=[];$(()=>T.value,t=>{N.splice(0,N.length,...t.map(e=>e.raw))});const ye=async()=>{const t=M.value==="first"?S:N;if(!t||t.length===0){v.warning("请先选择要上传的文件");return}try{const e=[];t.forEach(s=>{e.push({originalName:s.name,contentType:s.type,size:s.size})});const b=(await Re(e)).data.data;if(!window.APP_CONFIG.USE_MOCK){const s=[];b.forEach((m,_)=>{s.push(Ye.put(m.uploadUrl,t[_],{headers:{"Content-Type":t[_]?.type},onUploadProgress:w=>{const f=Math.round(w.loaded/w.total*100);console.log("上传进度:",f)}}))}),Promise.all(s).then(async m=>{const _=[];m.forEach((w,f)=>{const L=w.headers.etag?.replace(/"/g,"");_.push({name:t[f]?.name,parentId:R.value,bucketName:window.APP_CONFIG.BUCKET,objectKey:b[f].objectName,fileSize:t[f]?.size,contentType:t[f]?.type,fileExt:t[f]?.name.split(".").pop()?.toLowerCase(),etag:L})}),await He(_),v.success("文件上传成功"),k.value=!1,W.value?.clearFiles(),J.value?.clearFiles(),t.splice(0,t.length),await c()}).catch(m=>{console.log("上传失败: ",m)})}}catch(e){console.error("文件上传失败:",e)}},be=()=>{O.prompt("输入文件夹名称","提示",{confirmButtonText:"确认",cancelButtonText:"取消",inputPattern:/^[^\\/:*?"<>|]+$/,inputErrorMessage:"无效名称"}).then(async({value:t})=>{await qe({name:t.trim(),parentId:R.value}),await c(),v.success("文件夹创建成功")}).catch(()=>{v({type:"info",message:"取消创建"})})},we=ae(()=>oe(()=>import("./MoveDest-BuIihK3P.js"),__vite__mapDeps([3,1,2,4]))),y=p(!1),h=Ee([]),Ce=async t=>{y.value=!0,h.splice(0,h.length,t)};$(()=>y.value,t=>{!t&&c()});const ke=async t=>{O.confirm(`确认删除 ${t.name} 吗？`,"提示",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"}).then(async()=>{await Ge(t.id),c(),v({type:"success",message:"删除成功"})}).catch(()=>{v({type:"info",message:"未删除"})})},he=async()=>{try{const t=await We({itemIds:g.map(s=>s.id)}),e=t.headers["content-disposition"];let i="download.zip";if(e){const s=e.match(/filename="?(.+)"?/);s?.[1]&&(i=decodeURIComponent(s[1]))}const b=new Blob([t.data],{type:"application/zip"});Je(b,i)}catch(t){console.log("批量下载失败",t)}},xe=()=>{y.value=!0,h.splice(0,h.length,...g)},ze=()=>{O.confirm("确认删除所选文件（夹）吗？","提示",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"}).then(async()=>{await Qe({itemIds:g.map(t=>t.id)}),c(),v({type:"success",message:"删除成功"})}).catch(()=>{v({type:"info",message:"未删除"})})},Ve=async t=>{try{const e=await Xe(t.id);v.success(e.data.msg)}catch(e){console.log(e)}};return(t,e)=>{const i=u("el-button"),b=u("el-input"),s=u("el-table-column"),m=u("el-dropdown-item"),_=u("el-dropdown-menu"),w=u("el-dropdown"),f=u("el-table"),L=u("el-pagination"),Q=u("upload-filled"),X=u("el-icon"),Z=u("el-upload"),ee=u("el-tab-pane"),Be=u("el-tabs"),Ue=u("el-dialog"),Ie=u("el-drawer");return x(),Me("div",Ze,[d("div",et,[l(De,{"breadcrumb-list":n(se),sepa:"/",clickable:!0,onMenuClick:n(Y)},null,8,["breadcrumb-list","onMenuClick"]),te(d("div",null,[l(i,{onClick:he},{default:o(()=>[...e[12]||(e[12]=[r("批量下载",-1)])]),_:1}),l(i,{onClick:xe},{default:o(()=>[...e[13]||(e[13]=[r("批量移动",-1)])]),_:1}),l(i,{type:"danger",onClick:ze},{default:o(()=>[...e[14]||(e[14]=[r("批量删除",-1)])]),_:1})],512),[[le,n(g).length>0]])]),d("div",tt,[d("div",lt,[l(b,{modelValue:n(U),"onUpdate:modelValue":e[0]||(e[0]=a=>K(U)?U.value=a:null),placeholder:"输入文件名称",clearable:"",onClear:n(c),onKeyup:Se(n(c),["enter","active"])},{append:o(()=>[l(i,{icon:"Search",onClick:n(c)},null,8,["onClick"])]),_:1},8,["modelValue","onClear","onKeyup"])]),d("div",null,[te(l(i,{icon:"Back",onClick:n(Y)},{default:o(()=>[...e[15]||(e[15]=[r("返回",-1)])]),_:1},8,["onClick"]),[[le,n(j).length>1]]),l(i,{type:"primary",icon:"Plus",onClick:e[1]||(e[1]=a=>k.value=!0)},{default:o(()=>[...e[16]||(e[16]=[r("上传文件",-1)])]),_:1}),l(i,{icon:"Plus",onClick:be},{default:o(()=>[...e[17]||(e[17]=[r("新建文件夹",-1)])]),_:1})])]),l(f,Te({data:n(re)},{[Ne(n(me))]:n(fe)},{onSelectionChange:e[2]||(e[2]=a=>n(g).splice(0,n(g).length,...a))}),{default:o(()=>[l(s,{type:"selection",width:"28"}),l(s,{prop:"name",label:"文件名","show-overflow-tooltip":""},{default:o(a=>[d("div",at,[d("img",{src:n(de)(a.row),alt:"icon",style:{width:"18px",height:"18px"}},null,8,ot),d("span",null,Le(a.row.name),1)])]),_:1}),n(H).isMobile?B("",!0):(x(),V(s,{key:0,prop:"fileSize",label:"大小",align:"center",formatter:(a,C,A)=>n(Oe)(A)},null,8,["formatter"])),n(H).isMobile?B("",!0):(x(),V(s,{key:1,prop:"createTime",label:"上传时间",align:"center",formatter:(a,C,A)=>n(Ae)(A).format("YYYY-MM-DD HH:mm:ss")},null,8,["formatter"])),l(s,{label:"操作",align:"center",width:"188"},{default:o(({row:a})=>[d("div",nt,[l(i,{size:"small",onClick:z(C=>Ce(a),["stop"])},{default:o(()=>[...e[18]||(e[18]=[r("移动",-1)])]),_:1},8,["onClick"]),l(i,{size:"small",type:"danger",onClick:z(C=>ke(a),["stop"])},{default:o(()=>[...e[19]||(e[19]=[r("删除",-1)])]),_:1},8,["onClick"]),a.type==="FILE"?(x(),V(w,{key:0,placement:"bottom-end"},{dropdown:o(()=>[l(_,null,{default:o(()=>[l(m,{onClick:z(C=>ve(a),["stop"])},{default:o(()=>[...e[21]||(e[21]=[r("下载",-1)])]),_:1},8,["onClick"]),l(m,{onClick:z(C=>ge(a),["stop"])},{default:o(()=>[...e[22]||(e[22]=[r("预览",-1)])]),_:1},8,["onClick"]),l(m,{onClick:z(C=>Ve(a),["stop"])},{default:o(()=>[...e[23]||(e[23]=[r("收藏",-1)])]),_:1},8,["onClick"])]),_:2},1024)]),default:o(()=>[l(i,{size:"small"},{default:o(()=>[...e[20]||(e[20]=[r(" 更多 ",-1)])]),_:1})]),_:2},1024)):B("",!0)])]),_:1})]),_:1},16,["data"]),d("div",st,[l(L,{"current-page":n(I),"onUpdate:currentPage":e[3]||(e[3]=a=>K(I)?I.value=a:null),"page-size":n(P),"onUpdate:pageSize":e[4]||(e[4]=a=>K(P)?P.value=a:null),"page-sizes":[10,20,30,40],layout:"total, sizes, prev, pager, next",total:n(ue),onSizeChange:n(ce),onCurrentChange:n(pe),size:"small"},null,8,["current-page","page-size","total","onSizeChange","onCurrentChange"])]),l(Ue,{modelValue:k.value,"onUpdate:modelValue":e[9]||(e[9]=a=>k.value=a),title:"文件上传",width:"460"},{footer:o(()=>[d("div",it,[l(i,{onClick:e[8]||(e[8]=a=>k.value=!1)},{default:o(()=>[...e[27]||(e[27]=[r("取消",-1)])]),_:1}),l(i,{type:"primary",onClick:ye},{default:o(()=>[...e[28]||(e[28]=[r("确认",-1)])]),_:1})])]),default:o(()=>[l(Be,{modelValue:M.value,"onUpdate:modelValue":e[7]||(e[7]=a=>M.value=a)},{default:o(()=>[l(ee,{label:"选择文件",name:"first"},{default:o(()=>[l(Z,{ref_key:"upload",ref:W,drag:"",action:"",multiple:"","auto-upload":!1,"file-list":D.value,"onUpdate:fileList":e[5]||(e[5]=a=>D.value=a)},{tip:o(()=>[...e[24]||(e[24]=[d("div",{class:"el-upload__tip"},null,-1)])]),default:o(()=>[l(X,{class:"el-icon--upload"},{default:o(()=>[l(Q)]),_:1}),e[25]||(e[25]=d("div",{class:"el-upload__text"},[r(" 将文件拖到此处，或 "),d("em",null,"点击上传")],-1))]),_:1},8,["file-list"])]),_:1}),l(ee,{label:"选择文件夹",name:"second"},{default:o(()=>[l(Z,{ref_key:"upload2",ref:J,drag:"",action:"",directory:"",multiple:"","auto-upload":!1,"file-list":T.value,"onUpdate:fileList":e[6]||(e[6]=a=>T.value=a)},{default:o(()=>[l(X,{class:"el-icon--upload"},{default:o(()=>[l(Q)]),_:1}),e[26]||(e[26]=d("div",{class:"el-upload__text"},[r(" 将文件夹拖到此处，或 "),d("em",null,"点击上传")],-1))]),_:1},8,["file-list"])]),_:1})]),_:1},8,["modelValue"])]),_:1},8,["modelValue"]),l(Ie,{modelValue:F.value,"onUpdate:modelValue":e[10]||(e[10]=a=>F.value=a),title:E.value,size:"70%",direction:"btt"},{default:o(()=>[l(n(_e),{url:G.value,ext:q.value,name:E.value},null,8,["url","ext","name"])]),_:1},8,["modelValue","title"]),y.value?(x(),V(n(we),{key:0,"cur-path":n(j),"move-visiable":y.value,"onUpdate:moveVisiable":e[11]||(e[11]=a=>y.value=a),"move-which":h},null,8,["cur-path","move-visiable","move-which"])):B("",!0)])}}}),mt=$e(dt,[["__scopeId","data-v-33deb49c"]]);export{mt as default};
