const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/Preview-Xs20M8WD.js","assets/index-Bxgbf_d_.js","assets/index-DJt8hWD7.css","assets/MoveDest-AjpIQ6zp.js","assets/useFileSystem-C-33kKEx.js"])))=>i.map(i=>d[i]);
import{d as Ve,a as Be,r as p,w as $,b as Ie,c as Ue,e as d,f as a,g as z,h as V,i as X,u as o,B as Pe,v as Z,j as n,k as u,l as Ee,m as K,n as Fe,t as Me,p as ee,o as w,q as te,s as r,x as De,y as Se,z as I,E as f,A as O,_ as Te}from"./index-Bxgbf_d_.js";import{u as Ne,f as Le,g as le,d as Ae,a as $e,b as Ke,c as Oe,e as je,h as Re,i as Ye,j as He,k as Ge}from"./useFileSystem-C-33kKEx.js";const qe={class:"files_wrapper"},We={class:"bc"},Je={class:"header"},Qe={class:"flex_center"},Xe={style:{display:"flex","align-items":"center",gap:"8px"}},Ze=["src"],et={class:"table-operations"},tt={class:"flex_center",style:{"margin-top":"16px"}},lt={class:"dialog-footer"},at=Ve({__name:"Files",setup(ot){const{path:j,parentId:R,multi:y,breadcrumbList:ae,cdUp:Y,loadIcons:oe,getIconUrl:ne,keyword:U,pageNum:P,pageSize:E,files:se,total:ie,loadTableData:m,handleCurrentChange:de,handleSizeChange:re,layoutStore:H,eventName:ue,handleRowClick:pe}=Ne();Be(()=>{oe(),m()});const ce=async t=>{try{const e=await le(t.id);Ae(e.data.data,t.name)}catch(e){console.log(e)}},me=ee(()=>te(()=>import("./Preview-Xs20M8WD.js"),__vite__mapDeps([0,1,2]))),F=p(!1),G=p(""),q=p(""),M=p(""),fe=async t=>{M.value=t.name;try{const e=await le(t.id);G.value=e.data.data,q.value=t.name.split(".").pop()?.toLowerCase()||""}catch(e){console.log(e)}finally{F.value=!0}},h=p(!1),D=p("first"),W=p(),S=p([]),T=[];$(()=>S.value,t=>{T.splice(0,T.length,...t.map(e=>e.raw))});const J=p(),N=p([]),L=[];$(()=>N.value,t=>{L.splice(0,L.length,...t.map(e=>e.raw))});const ve=async()=>{const t=D.value==="first"?T:L;if(!t||t.length===0){f.warning("请先选择要上传的文件");return}try{const e=[];t.forEach(i=>{e.push({originalName:i.name,contentType:i.type,size:i.size})});const C=(await $e(e)).data.data;if(!window.APP_CONFIG.USE_MOCK){const i=[];C.forEach((v,g)=>{i.push(Ke.put(v.uploadUrl,t[g],{headers:{"Content-Type":t[g]?.type},onUploadProgress:_=>{const c=Math.round(_.loaded/_.total*100);console.log("上传进度:",c)}}))}),Promise.all(i).then(async v=>{const g=[];v.forEach((_,c)=>{const B=_.headers.etag?.replace(/"/g,"");g.push({name:t[c]?.name,parentId:R.value,bucketName:window.APP_CONFIG.BUCKET,objectKey:C[c].objectName,fileSize:t[c]?.size,contentType:t[c]?.type,fileExt:t[c]?.name.split(".").pop()?.toLowerCase(),etag:B})}),await Oe(g),f.success("文件上传成功"),h.value=!1,W.value?.clearFiles(),J.value?.clearFiles(),t.splice(0,t.length),await m()}).catch(v=>{console.log("上传失败: ",v)})}}catch(e){console.error("文件上传失败:",e)}},ge=()=>{O.prompt("输入文件夹名称","提示",{confirmButtonText:"确认",cancelButtonText:"取消",inputPattern:/^[^\\/:*?"<>|]+$/,inputErrorMessage:"无效名称"}).then(async({value:t})=>{await Re({name:t.trim(),parentId:R.value}),await m(),f.success("文件夹创建成功")}).catch(()=>{f({type:"info",message:"取消创建"})})},_e=ee(()=>te(()=>import("./MoveDest-AjpIQ6zp.js"),__vite__mapDeps([3,1,2,4]))),b=p(!1),k=Ie([]),ye=async t=>{b.value=!0,k.splice(0,k.length,t)};$(()=>b.value,t=>{!t&&m()});const be=async t=>{O.confirm(`确认删除 ${t.name} 吗？`,"提示",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"}).then(async()=>{await je(t.id),m(),f({type:"success",message:"删除成功"})}).catch(()=>{f({type:"info",message:"未删除"})})},Ce=async()=>{try{const t=await Ye({itemIds:y.map(i=>i.id)}),e=t.headers["content-disposition"];let s="download.zip";if(e){const i=e.match(/filename="?(.+)"?/);i?.[1]&&(s=decodeURIComponent(i[1]))}const C=new Blob([t.data],{type:"application/zip"});He(C,s)}catch(t){console.log("批量下载失败",t)}},we=()=>{b.value=!0,k.splice(0,k.length,...y)},he=()=>{O.confirm("确认删除所选文件（夹）吗？","提示",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"}).then(async()=>{await Ge({itemIds:y.map(t=>t.id)}),m(),f({type:"success",message:"删除成功"})}).catch(()=>{f({type:"info",message:"未删除"})})};return(t,e)=>{const s=u("el-button"),C=u("el-input"),i=u("el-table-column"),v=u("el-table"),g=u("el-pagination"),_=u("upload-filled"),c=u("el-icon"),B=u("el-upload"),Q=u("el-tab-pane"),ke=u("el-tabs"),xe=u("el-dialog"),ze=u("el-drawer");return w(),Ue("div",qe,[d("div",We,[a(Pe,{"breadcrumb-list":o(ae),sepa:"/",clickable:!0,onMenuClick:o(Y)},null,8,["breadcrumb-list","onMenuClick"]),X(d("div",null,[a(s,{onClick:Ce},{default:n(()=>[...e[12]||(e[12]=[r("批量下载",-1)])]),_:1}),a(s,{onClick:we},{default:n(()=>[...e[13]||(e[13]=[r("批量移动",-1)])]),_:1}),a(s,{type:"danger",onClick:he},{default:n(()=>[...e[14]||(e[14]=[r("批量删除",-1)])]),_:1})],512),[[Z,o(y).length>0]])]),d("div",Je,[d("div",Qe,[a(C,{modelValue:o(U),"onUpdate:modelValue":e[0]||(e[0]=l=>K(U)?U.value=l:null),placeholder:"输入文件名称",clearable:"",onClear:o(m),onKeyup:Ee(o(m),["enter","active"])},{append:n(()=>[a(s,{icon:"Search",onClick:o(m)},null,8,["onClick"])]),_:1},8,["modelValue","onClear","onKeyup"])]),d("div",null,[X(a(s,{icon:"Back",onClick:o(Y)},{default:n(()=>[...e[15]||(e[15]=[r("返回",-1)])]),_:1},8,["onClick"]),[[Z,o(j).length>1]]),a(s,{type:"primary",icon:"Plus",onClick:e[1]||(e[1]=l=>h.value=!0)},{default:n(()=>[...e[16]||(e[16]=[r("上传文件",-1)])]),_:1}),a(s,{icon:"Plus",onClick:ge},{default:n(()=>[...e[17]||(e[17]=[r("新建文件夹",-1)])]),_:1})])]),a(v,Fe({data:o(se)},{[Me(o(ue))]:o(pe)},{onSelectionChange:e[2]||(e[2]=l=>o(y).splice(0,o(y).length,...l))}),{default:n(()=>[a(i,{type:"selection",width:"28"}),a(i,{prop:"name",label:"文件名","show-overflow-tooltip":""},{default:n(l=>[d("div",Xe,[d("img",{src:o(ne)(l.row),alt:"icon",style:{width:"18px",height:"18px"}},null,8,Ze),d("span",null,De(l.row.name),1)])]),_:1}),o(H).isMobile?V("",!0):(w(),z(i,{key:0,prop:"fileSize",label:"大小",align:"center",formatter:(l,x,A)=>o(Le)(A)},null,8,["formatter"])),o(H).isMobile?V("",!0):(w(),z(i,{key:1,prop:"createTime",label:"上传时间",align:"center",formatter:(l,x,A)=>o(Se)(A).format("YYYY-MM-DD HH:mm:ss")},null,8,["formatter"])),a(i,{label:"操作",align:"center",width:"188"},{default:n(({row:l})=>[d("div",et,[l.type==="FILE"?(w(),z(s,{key:0,size:"small",onClick:I(x=>ce(l),["stop"])},{default:n(()=>[...e[18]||(e[18]=[r("下载",-1)])]),_:1},8,["onClick"])):V("",!0),l.type==="FILE"?(w(),z(s,{key:1,size:"small",onClick:I(x=>fe(l),["stop"])},{default:n(()=>[...e[19]||(e[19]=[r("预览",-1)])]),_:1},8,["onClick"])):V("",!0),a(s,{size:"small",onClick:I(x=>ye(l),["stop"])},{default:n(()=>[...e[20]||(e[20]=[r("移动",-1)])]),_:1},8,["onClick"]),a(s,{size:"small",type:"danger",onClick:I(x=>be(l),["stop"])},{default:n(()=>[...e[21]||(e[21]=[r("删除",-1)])]),_:1},8,["onClick"])])]),_:1})]),_:1},16,["data"]),d("div",tt,[a(g,{"current-page":o(P),"onUpdate:currentPage":e[3]||(e[3]=l=>K(P)?P.value=l:null),"page-size":o(E),"onUpdate:pageSize":e[4]||(e[4]=l=>K(E)?E.value=l:null),"page-sizes":[10,20,30,40],layout:"total, sizes, prev, pager, next",total:o(ie),onSizeChange:o(re),onCurrentChange:o(de),size:"small"},null,8,["current-page","page-size","total","onSizeChange","onCurrentChange"])]),a(xe,{modelValue:h.value,"onUpdate:modelValue":e[9]||(e[9]=l=>h.value=l),title:"文件上传",width:"460"},{footer:n(()=>[d("div",lt,[a(s,{onClick:e[8]||(e[8]=l=>h.value=!1)},{default:n(()=>[...e[25]||(e[25]=[r("取消",-1)])]),_:1}),a(s,{type:"primary",onClick:ve},{default:n(()=>[...e[26]||(e[26]=[r("确认",-1)])]),_:1})])]),default:n(()=>[a(ke,{modelValue:D.value,"onUpdate:modelValue":e[7]||(e[7]=l=>D.value=l)},{default:n(()=>[a(Q,{label:"选择文件",name:"first"},{default:n(()=>[a(B,{ref_key:"upload",ref:W,drag:"",action:"",multiple:"","auto-upload":!1,"file-list":S.value,"onUpdate:fileList":e[5]||(e[5]=l=>S.value=l)},{tip:n(()=>[...e[22]||(e[22]=[d("div",{class:"el-upload__tip"},null,-1)])]),default:n(()=>[a(c,{class:"el-icon--upload"},{default:n(()=>[a(_)]),_:1}),e[23]||(e[23]=d("div",{class:"el-upload__text"},[r(" 将文件拖到此处，或 "),d("em",null,"点击上传")],-1))]),_:1},8,["file-list"])]),_:1}),a(Q,{label:"选择文件夹",name:"second"},{default:n(()=>[a(B,{ref_key:"upload2",ref:J,drag:"",action:"",directory:"",multiple:"","auto-upload":!1,"file-list":N.value,"onUpdate:fileList":e[6]||(e[6]=l=>N.value=l)},{default:n(()=>[a(c,{class:"el-icon--upload"},{default:n(()=>[a(_)]),_:1}),e[24]||(e[24]=d("div",{class:"el-upload__text"},[r(" 将文件夹拖到此处，或 "),d("em",null,"点击上传")],-1))]),_:1},8,["file-list"])]),_:1})]),_:1},8,["modelValue"])]),_:1},8,["modelValue"]),a(ze,{modelValue:F.value,"onUpdate:modelValue":e[10]||(e[10]=l=>F.value=l),title:M.value,size:"70%",direction:"btt"},{default:n(()=>[a(o(me),{url:G.value,ext:q.value,name:M.value},null,8,["url","ext","name"])]),_:1},8,["modelValue","title"]),b.value?(w(),z(o(_e),{key:0,"cur-path":o(j),"move-visiable":b.value,"onUpdate:moveVisiable":e[11]||(e[11]=l=>b.value=l),"move-which":k},null,8,["cur-path","move-visiable","move-which"])):V("",!0)])}}}),it=Te(at,[["__scopeId","data-v-64a1ea50"]]);export{it as default};
